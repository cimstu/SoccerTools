openapi: 3.0.3
info:
  title: SoccerTools API
  description: API 规格先行；实现需符合本 spec。
  version: 0.1.0

servers:
  - url: http://localhost:3000
    description: 本地开发

paths:
  # 示例：健康检查（实现时按此契约）
  /health:
    get:
      summary: 健康检查
      operationId: getHealth
      responses:
        '200':
          description: 服务正常
          content:
            application/json:
              schema:
                type: object
                required: [status]
                properties:
                  status:
                    type: string
                    example: ok

  # 巴萨比赛录像：查询最近 N 天（默认 7 天）。规约：不透露比赛比分。
  /replays:
    get:
      summary: 查询巴塞罗那比赛录像（最近 N 天）
      description: 返回录像列表，仅含标题、链接、日期；不得包含或透露比赛比分。
      operationId: getBarcelonaReplays
      parameters:
        - name: days
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 30
            default: 7
          description: 最近天数，默认 7
      responses:
        '200':
          description: 录像列表
          content:
            application/json:
              schema:
                type: object
                required: [items]
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/ReplayItem'
        '400':
          description: 参数错误

  # 触发立即爬取一次（供 Web 页「刷新」使用）
  /replays/refresh:
    post:
      summary: 立即爬取一次录像数据
      operationId: refreshReplays
      responses:
        '200':
          description: 爬取已触发并完成
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  message:
                    type: string

  # Web 页面：巴萨录像查询与刷新（GET / 返回 HTML）
  /:
    get:
      summary: 巴萨录像查询页
      description: 返回 HTML 页面，支持按天数查询录像列表与手动刷新数据。
      operationId: getReplaysPage
      responses:
        '200':
          description: HTML 页面

components:
  schemas:
    ReplayItem:
      type: object
      description: 单条录像信息。规约约束 - 不得包含比赛比分，仅允许 title/url/date。
      required: [title, url, date]
      properties:
        title:
          type: string
          description: 比赛标题（如 巴塞罗那vsXXX），不得包含比分
        url:
          type: string
          format: uri
        date:
          type: string
          format: date
      # 禁止扩展字段，避免后续误加 score 等
      additionalProperties: false
  securitySchemes: {}
